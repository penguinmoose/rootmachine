<!DOCTYPE HTML>
<html>

  <head>
    <style>
       body {
        background-image: url("sqrtx.png");
       }
       p {
         font-family: "courier new";
       }
       div {
         font-family: "courier new";
       }
      </style>
    </head>
<body onload="loadPrevAnswer()">
  <h1>root machine</h1>
    <div>
      <form name="valform">
          <input type="text" name="rootnumber" id="rootnumber" value="2" />th root<br>
          root of...(no values above 100 allowed here) <input type="text" name="n" id="n" value="2" /><br>
          Precision: <input type="text" name="precision" id="precision" value="10" />

          <input type="button" onclick="start();" value="Go!">
      </form>
    </div>

  <p>This will calculate the root of your number.</p>
  <p>The answer is <b id="answer"></b>.</p>

  <script src='big.min.js'></script>
    <script>

    function setCookie(cname, cvalue, exdays) {
      var d = new Date();
      d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
      var expires = "expires="+d.toUTCString();
      document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
      var name = cname + "=";
      var ca = document.cookie.split(';');
      for(var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    function loadPrevAnswer() {
      var answer = getCookie("answer");
      if (answer != "") {
        document.getElementById("answer").innerHTML = answer;
        document.getElementById("rootnumber").innerHTML = getCookie("rootnumber");
        document.getElementById("precision").innerHTML = getCookie("precision");
        document.getElementById("n").innerHTML = getCookie("n");
      }
    }

      var input = document.getElementById("n");
      input.addEventListener("keyup", function(event) {
        if (event.keyCode === 13) {
          event.preventDefault();
          start();
        }
      });

      Big.DP = 500;

        function calculate(n, rootnumber, precision, min, max) {
          var error = new Big(0.1).pow(precision);
          var mid = min.plus(max).div(2);
          var new_answer = mid.pow(rootnumber);

          if (new_answer.gt(n.minus(error)) && new_answer.lt(n.plus(error))) {
            document.getElementById("answer").innerHTML = "" + mid.round(precision);
            var a = mid.round(precision);
            document.getElementById("answer").innerHTML = "" + a;
            setCookie("answer", "" + a, 100);
            setCookie("rootnumber", rootnumber, 100);
            setCookie("precision", precision, 100);
            setCookie("n", n, 100);
            console.log(getCookie("answer"));
            return;
          }

          if (new_answer.gt(n)) {
            max = mid;
          } else {
            min = mid;
          }
          document.getElementById("answer").innerHTML = "about " + mid.round(precision);
          setTimeout(function() {
            calculate(n, rootnumber, precision, min, max);
          }, 100)
        }

        function start() {
          var n = parseInt(document.getElementById("n").value);
          var rootnumber = parseInt(document.getElementById("rootnumber").value);
          var precision = parseInt(document.getElementById("precision").value);
          console.log('test');
          console.log(n);
          calculate(new Big(n), rootnumber, precision, new Big(0), new Big(10));
        }
    </script>
  </body>
</html>
